scripted_gui = {
	great_game_influence_gui = {
		context_type = decision_category
		window_name = "great_game_influence_window"

		properties = {
			great_game_influence_game_frame_PER={
				image = "[?PER.GetFlag]"
			}
			great_game_influence_game_frame_SIK={
				image = "[?SIK.GetFlag]"
			}
			great_game_influence_game_frame_TIB={
				image = "[?TIB.GetFlag]"
			}
			great_game_influence_game_frame_AFG={
				image = "[?AFG.GetFlag]"
			}
			great_game_bukara_influence = {
				frame = global.great_game_bukara
			}
			great_game_khiva_influence = {
				frame = global.great_game_khiva
			}
			great_game_afghan_influence = {
				frame = global.great_game_afghan
			}
			great_game_kokand_influence = {
				frame = global.great_game_kokand
			}
			great_game_south_turkmen_influence = {
				frame = global.great_game_s_turkmen
			}
			great_game_north_turkmen_influence = {
				frame = global.great_game_n_turkmen
			}
			great_game_panjeh_influence = {
				frame = global.great_game_panjeh
			}
			great_game_peshawar_influence = {
				frame = global.great_game_peshawar
			}
			great_game_samarkand_influence = {
				frame = global.great_game_samarkand
			}
			great_game_persian_coast_influence = {
				frame = global.great_game_persian_coast
			}
			great_game_central_persia_influence = {
				frame = global.great_game_central_persia
			}
			great_game_persian_highlands_influence = {
				frame = global.great_game_persian_highlands
			}
			great_game_wukhan_influence = {
				frame = global.great_game_wukhan
			}
			great_game_tibet_influence = {
				frame = global.great_game_tibet
			}
			great_game_sikang_influence = {
				frame = global.great_game_sikang
			}
			great_game_kazakh_influence = {
				frame = global.great_game_kazakh
			}
		}
		effects={
			great_game_invest_influence_game_frame_PER_click ={
				if={#add a influence point
					limit={tag=RUS}
					add_to_variable ={PER.RUS_gg_influence = 1}
				}
				else={
					add_to_variable ={PER.ENG_gg_influence = 1}
				}
				#check if anyone is 5+ points ahead
				set_temp_variable = {temp_influence_difference = 4}
				add_to_temp_variable = {temp_influence_difference = PER.RUS_gg_influence}
				if={
					limit={
						check_variable = {PER.ENG_gg_influence>temp_influence_difference}
					}
					PER={set_country_flag = ENG_becoming_dominate}
				}
				set_temp_variable = {temp_influence_difference = 4}
				add_to_temp_variable = {temp_influence_difference = PER.ENG_gg_influence}
				if={
					limit={
						check_variable = {PER.RUS_gg_influence>temp_influence_difference}
					}
					PER={set_country_flag = RUS_becoming_dominate}
				}
				
				set_temp_variable = {temp_influence_difference = 5}
				add_to_temp_variable = {temp_influence_difference = PER.RUS_gg_influence}
				if={
					limit={
						PER={has_country_flag = ENG_becoming_dominate}
						check_variable = {PER.ENG_gg_influence<temp_influence_difference}
					}
					PER={clr_country_flag = ENG_becoming_dominate}
				}
				set_temp_variable = {temp_influence_difference = 5}
				add_to_temp_variable = {temp_influence_difference = PER.ENG_gg_influence}
				if={
					limit={
						PER={has_country_flag = RUS_becoming_dominate}
						check_variable = {PER.RUS_gg_influence<temp_influence_difference}
					}
					PER={clr_country_flag = RUS_becoming_dominate}
				}
				subtract_from_variable = {great_game_points = 10}
			}
			great_game_invest_influence_game_frame_TIB_click ={
				if={#add a influence point
					limit={tag=RUS}
					add_to_variable ={TIB.RUS_gg_influence = 1}
				}
				else={
					add_to_variable ={TIB.ENG_gg_influence = 1}
				}
				#check if anyone is 5+ points ahead
				set_temp_variable = {temp_influence_difference = 4}
				add_to_temp_variable = {temp_influence_difference = TIB.RUS_gg_influence}
				if={
					limit={
						check_variable = {TIB.ENG_gg_influence>temp_influence_difference}
					}
					TIB={set_country_flag = ENG_becoming_dominate}
				}
				set_temp_variable = {temp_influence_difference = 4}
				add_to_temp_variable = {temp_influence_difference = TIB.ENG_gg_influence}
				if={
					limit={
						check_variable = {TIB.RUS_gg_influence>temp_influence_difference}
					}
					TIB={set_country_flag = RUS_becoming_dominate}
				}
				#check if the gap has been closed
				set_temp_variable = {temp_influence_difference = 5}
				add_to_temp_variable = {temp_influence_difference = TIB.RUS_gg_influence}
				if={
					limit={
						TIB={has_country_flag = RUS_becoming_dominate}
						check_variable = {TIB.ENG_gg_influence<temp_influence_difference}
					}
					TIB={clr_country_flag = RUS_becoming_dominate}
				}
				set_temp_variable = {temp_influence_difference = 5}
				add_to_temp_variable = {temp_influence_difference = TIB.ENG_gg_influence}
				if={
					limit={
						TIB={has_country_flag = ENG_becoming_dominate}
						check_variable = {TIB.RUS_gg_influence<temp_influence_difference}
					}
					TIB={clr_country_flag = ENG_becoming_dominate}
				}
				subtract_from_variable = {great_game_points = 10}
			}
			great_game_invest_influence_game_frame_SIK_click ={
				if={#add a influence point
					limit={tag=RUS}
					add_to_variable ={SIK.RUS_gg_influence = 1}
				}
				else={
					add_to_variable ={SIK.ENG_gg_influence = 1}
				}
				#check if anyone is 5+ points ahead
				set_temp_variable = {temp_influence_difference = 4}
				add_to_temp_variable = {temp_influence_difference = SIK.RUS_gg_influence}
				if={
					limit={
						check_variable = {SIK.ENG_gg_influence>temp_influence_difference}
					}
					SIK={set_country_flag = ENG_becoming_dominate}
				}
				set_temp_variable = {temp_influence_difference = 4}
				add_to_temp_variable = {temp_influence_difference = SIK.ENG_gg_influence}
				if={
					limit={
						check_variable = {SIK.RUS_gg_influence>temp_influence_difference}
					}
					SIK={set_country_flag = RUS_becoming_dominate}
				}
				#check if the gap has been closed
				set_temp_variable = {temp_influence_difference = 5}
				add_to_temp_variable = {temp_influence_difference = SIK.RUS_gg_influence}
				if={
					limit={
						SIK={has_country_flag = RUS_becoming_dominate}
						check_variable = {SIK.ENG_gg_influence<temp_influence_difference}
					}
					SIK={clr_country_flag = RUS_becoming_dominate}
				}
				set_temp_variable = {temp_influence_difference = 5}
				add_to_temp_variable = {temp_influence_difference = SIK.ENG_gg_influence}
				if={
					limit={
						SIK={has_country_flag = ENG_becoming_dominate}
						check_variable = {SIK.RUS_gg_influence<temp_influence_difference}
					}
					SIK={clr_country_flag = ENG_becoming_dominate}
				}
				subtract_from_variable = {great_game_points = 10}
			}
			great_game_invest_influence_game_frame_AFG_click ={
				if={#add a influence point
					limit={tag=RUS}
					add_to_variable ={AFG.RUS_gg_influence = 1}
				}
				else={
					add_to_variable ={AFG.ENG_gg_influence = 1}
				}
				#check if anyone is 5+ points ahead
				set_temp_variable = {temp_influence_difference = 4}
				add_to_temp_variable = {temp_influence_difference = AFG.RUS_gg_influence}
				if={
					limit={
						check_variable = {AFG.ENG_gg_influence>temp_influence_difference}
					}
					AFG={set_country_flag = ENG_becoming_dominate}
				}
				set_temp_variable = {temp_influence_difference = 4}
				add_to_temp_variable = {temp_influence_difference = AFG.ENG_gg_influence}
				if={
					limit={
						check_variable = {AFG.RUS_gg_influence>temp_influence_difference}
					}
					AFG={set_country_flag = RUS_becoming_dominate}
				}
				#check if the gap has been closed
				set_temp_variable = {temp_influence_difference = 5}
				add_to_temp_variable = {temp_influence_difference = AFG.RUS_gg_influence}
				if={
					limit={
						AFG={has_country_flag = RUS_becoming_dominate}
						check_variable = {AFG.ENG_gg_influence<temp_influence_difference}
					}
					AFG={clr_country_flag = RUS_becoming_dominate}
				}
				set_temp_variable = {temp_influence_difference = 5}
				add_to_temp_variable = {temp_influence_difference = AFG.ENG_gg_influence}
				if={
					limit={
						AFG={has_country_flag = ENG_becoming_dominate}
						check_variable = {AFG.RUS_gg_influence<temp_influence_difference}
					}
					AFG={clr_country_flag = ENG_becoming_dominate}
				}
				subtract_from_variable = {great_game_points = 10}
			}
		}
		triggers = {
			great_game_invest_influence_game_frame_PER_click_enabled ={
				check_variable = {great_game_points > 9}
			}
			great_game_invest_influence_game_frame_TIB_click_enabled ={
				check_variable = {great_game_points > 9}
			}
			great_game_invest_influence_game_frame_SIK_click_enabled ={
				check_variable = {great_game_points > 9}
			}
			great_game_invest_influence_game_frame_AFG_click_enabled ={
				check_variable = {great_game_points > 9}
			}
			great_game_bukara_contest_visible={
				check_variable = { global.great_game_stage = 3}
				BUK={exists = yes}
			}
			great_game_kokand_contest_visible={
				check_variable = { global.great_game_stage = 3}
				KOK={exists = yes}
			}
			great_game_samarkand_contest_visible={
				check_variable = { global.great_game_stage = 3}
				SMK={exists = yes}
			}
			great_game_khiva_contest_visible={
				check_variable = { global.great_game_stage = 4}
				KHI={exists = yes}
			}
			great_game_turkmen_contest_visible={
				OR={
					check_variable = { global.great_game_stage = 4}
					check_variable = { global.great_game_stage = 5}
				}
				TMS={exists = yes}
			}
			great_game_afghan_contest_visible={
				OR={
					check_variable = { global.great_game_stage = 4}
					check_variable = { global.great_game_stage = 5}
				}
				AFG={exists = yes}
			}
			great_game_kazakh_contest_visible={
				check_variable = { global.great_game_stage = 3}
				RUS={NOT={owns_state = 943}}
			}
			great_game_peshawar_contest_visible={
				check_variable = { global.great_game_stage = 4}
				ENG={NOT={owns_state = 445}}
			}
			great_game_panjeh_contest_visible={
				check_variable = { global.great_game_stage = 5}
				RUS={NOT={owns_state = 1360}}
			}
			great_game_wukhan_contest_visible={
				check_variable = { global.great_game_stage = 6}
				#RUS={NOT={owns_state = 1360}}
			}
			
			great_game_influence_game_frame_PER_visible={
				PER = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
			}
			great_game_invest_influence_game_frame_PER_visible={
				PER = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
			}
			RUS_influence_PER_visible={
				PER = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
			}
			ENG_influence_PER_visible={
				PER = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
			}
			great_game_influence_game_frame_TIB_visible={
				TIB = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
			}
			great_game_invest_influence_game_frame_TIB_visible={
				TIB = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
			}
			RUS_influence_TIB_visible={
				TIB = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
			}
			ENG_influence_TIB_visible={
				TIB = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
			}
			great_game_influence_game_frame_SIK_visible={
				TIB = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 4}
			}
			great_game_invest_influence_game_frame_SIK_visible={
				TIB = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 4}
			}
			RUS_influence_SIK_visible={
				TIB = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 4}
			}
			ENG_influence_SIK_visible={
				TIB = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 4}
			}
			great_game_influence_game_frame_AFG_visible={
				AFG = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
				check_variable = { global.great_game_afghan < 7}
			}
			great_game_invest_influence_game_frame_AFG_visible={
				AFG = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
				check_variable = { global.great_game_afghan < 7}
			}
			RUS_influence_AFG_visible={
				AFG = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
				check_variable = { global.great_game_afghan < 7}
			}
			ENG_influence_AFG_visible={
				AFG = {
					exists = yes
					NOT={
						has_country_flag=RUS_sphere
						has_country_flag=ENG_sphere
					}
				}
				check_variable = { global.great_game_stage > 5}
				check_variable = { global.great_game_afghan < 7}
			}
		}
		
	}
}